# Harris Farm Weather System — Index

## System Overview

Weather-driven demand forecasting for Harris Farm Markets. Uses per-store weather data to automatically adjust buying forecasts for weather-sensitive products (ice cream, salads, soup, BBQ meats, etc.).

## Data Flow

```
WeatherAPI.com ──> weather_data_loader.py ──> weather.db
                                                  |
                           ┌──────────────────────┼──────────────────────┐
                           |                      |                      |
                  weather_demand_planner.py   weather_dashboard.py   Direct SQL
                           |                      |
                      Adjusted demand        Morning reports
                      Buying alerts          CSV exports
```

## File Index

### Core Modules

| File | Lines | Purpose |
|------|-------|---------|
| `weather_db_schema.sql` | ~170 | Database DDL — 7 tables, 9 indexes, 3 views |
| `weather_data_loader.py` | ~340 | API integration, data ingestion, store/product management |
| `weather_demand_planner.py` | ~300 | Demand calculation engine, buying alerts, forecast summaries |
| `weather_dashboard.py` | ~290 | Terminal reports, CSV export, morning dashboard |
| `example_products.py` | ~250 | 25 categories, 42 products, 5 sample stores |

### Scripts & Configuration

| File | Purpose |
|------|---------|
| `install.sh` | One-command installation (deps, DB, sample data) |
| `setup_automation.sh` | Creates cron scripts + prints crontab entries |
| `test_system.py` | Comprehensive system verification (DB, data, modules, integration) |
| `requirements.txt` | Python dependencies (pandas, requests, numpy, scipy) |

### Generated by `setup_automation.sh`

| File | Purpose |
|------|---------|
| `daily_weather_update.py` | Cron script: fetch forecasts at 6 AM |
| `generate_daily_dashboard.py` | Cron script: morning report at 7 AM |
| `backup_weather_db.sh` | Cron script: nightly DB backup with 30-day retention |

### Documentation

| File | Audience | Content |
|------|----------|---------|
| `GETTING_STARTED.md` | New users | 5-min quickstart, multiplier examples, daily workflow |
| `README_WEATHER_DB.md` | Developers | Full schema reference, API details, SQL queries, integration |
| `INDEX.md` | Everyone | This file — system map and file index |

### Data & Output Directories

| Directory | Contents |
|-----------|----------|
| `logs/` | Application and cron logs |
| `backups/` | Timestamped database snapshots (30-day retention) |
| `exports/` | CSV buying reports for ordering systems |

---

## File Tree

```
harris_farm_weather/
├── weather_db_schema.sql          # Database schema
├── weather_data_loader.py         # Data ingestion from WeatherAPI
├── weather_demand_planner.py      # Demand adjustment engine
├── weather_dashboard.py           # Reports and CSV export
├── example_products.py            # Sample categories, products, stores
├── install.sh                     # Installation script
├── setup_automation.sh            # Cron automation setup
├── test_system.py                 # System verification tests
├── requirements.txt               # Python dependencies
├── GETTING_STARTED.md             # Quick start guide
├── README_WEATHER_DB.md           # Technical reference
├── INDEX.md                       # This file
├── weather.db                     # SQLite database (generated)
├── logs/                          # Log files (generated)
├── backups/                       # DB backups (generated)
└── exports/                       # CSV reports (generated)
```

---

## Customisation Guide

### Adding Stores

Edit `example_products.py` → `SAMPLE_STORES` list, or use the API:

```python
loader.add_store(42, "Bondi Junction", "Bondi Junction", "NSW", "2022",
                 -33.8912, 151.2472)
```

### Adding Products

Edit `example_products.py` → `PRODUCTS` list, or use the API:

```python
loader.add_product_profile("NEW001", "New Product", "Category Name",
                           hot=1.5, cold=0.8, rain=0.9, sunny=1.1,
                           lead_days=2)
```

### Adjusting Multipliers

The multipliers in `example_products.py` are starting points. Refine them by comparing weather-adjusted forecasts against actual sales data over time.

### Changing Weather Thresholds

The threshold rules are in `WeatherDemandPlanner._calculate_multiplier()`:
- Hot: > 30C
- Cold: < 15C
- Rain: > 5mm
- Sunny: 20-28C and < 2mm rain
- Extreme: > 38C

Adjust these to match your market's climate patterns.

---

## Key Design Decisions

1. **SQLite** — No external database server needed. Single file, portable, works offline.
2. **Per-store GPS** — Each store gets its own forecast. Coastal vs inland matters.
3. **Lead time awareness** — Alerts fire N days before impact, not on the day.
4. **Compound multipliers** — Hot + rain = reduced BBQ, not just "hot".
5. **Confidence tracking** — Longer horizons = lower confidence = softer recommendations.
6. **CSV export** — Simple integration with any ordering system.
7. **Rate limiting** — 1-second pauses between API calls protect the free tier.
